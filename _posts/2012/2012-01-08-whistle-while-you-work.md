---
title: "Whistle while you Work"
category: archive
---
After the frustration I had with PyBox2D, I couldn't just let all that time I spent installing and learning Python and PyGame go to waste. So I started in on a new project. One that I'm ONLY going to work on when I'm not at home. Python and PyGame are available in portable versions and won't take up much room on my USB Drive.

So, the working title of the new game is Wizard Plumber. It will be a single-screen puzzler. There will be a source of water on one side of the screen, and one or more water receivers elsewhere on the screen. The player will be able to rotate pipes at fixed locations on the screen to try and get the water from the source to all the receivers. The cool part is that the player will have 3 "magic pipes" that they can place wherever they want to force the water to turn at a right angle. Once placed, these magic pipes cannot be moved or rotated, but they can be taken back, rotated, and placed somewhere else. Rotating a regular pipe is done by simply clicking on one and placing a magic pipe is done by dragging the mouse over a water stream.

I implemented my own simple particle system to control the water. I ran into some trouble initially when I started placing too many pipes on the screen. At about 1000 particles, the framerate slowed noticeably. I was only looping through the particle array 3 times: once for updating, once for collision checking, and once for rendering. After searching around online a bit, I found out that there's a better approach than what I was using. My particles were, in code, represented as a List of Objects. After converting them to a List of Lists (or struts if you prefer), I could have 2000 particles on screen before the framerate started slowing down. I needed about 12 pipes placed at the farthest ends of the screen to get that many particles. I'll think about trying to optimize this when I get to actually designing puzzles.

Currently, my pipes are implemented as Node objects. A Node has one or more Particle Emitters and one or more Particle Receivers. A typical Node will have a central Receiver to prevent particles from just passing through it, and an Emitter-Receiver pair for each end of the pipe that the Node can receive or emit water from. This means that a Node representing a T-junction pipe has 7 objects in it. All of which need updating and collision checking as the Particle System moves along. That probably wasn't the best solution. I'm going to go back and rewrite the Node class so that it only contains a central Rectangle for receiving particles, and one Rectangle for each end of its pipe for emitting particles. It will know which directions it can receive particles from, and, from there, it can extrapolate which directions it needs to emit particles from when stimulated by a stream of water.

Yeowza, that's a lot of text. But that's understandable. I've already been working on this project for about 18 hours (not straight, of course), so there's bound to be a lot to catch up on. Sadly, I probably won't be able to post any screenshots since I'm trying to keep this separate from my main project.